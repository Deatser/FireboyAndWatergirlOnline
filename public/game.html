<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<title>Игра</title>
		<link rel="stylesheet" href="css/game.css" />

		<!-- Проверка isPlaying до рендера страницы -->
		<script type="module">
			import { db } from './js/firebase-config.js'
			import {
				ref,
				get,
			} from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js'

			const playerUid = localStorage.getItem('playerUid')
			if (!playerUid) {
				window.location.replace('index.html')
			} else {
				;(async () => {
					try {
						const snap = await get(ref(db, `users/${playerUid}/isPlaying`))
						if (!snap.val()) {
							window.location.replace('index.html')
						}
					} catch (err) {
						console.error(err)
						window.location.replace('index.html')
					}
				})()
			}
		</script>
	</head>
	<body>
		<div id="gameContainer">
			<div class="box">
				<canvas id="gameCanvas"></canvas>
			</div>
			<div class="buttons">
				<button id="endGameBtn" class="game-btn">Закончить игру</button>
				<button id="toggleCollBtn" class="game-btn">Включить хитбоксы</button>
			</div>
		</div>

		<script type="module" src="./js/game.js"></script>
	</body>
</html>
